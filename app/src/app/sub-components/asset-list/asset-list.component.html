<section class="shared-panel">
  <header class="section-header shared-section-header">
    <div>
      <p class="shared-kicker">Asset Management</p>
      <h2>Asset List</h2>
      <p class="shared-subtitle">All available assets from the backend API.</p>
    </div>

    <p-button
      icon="pi pi-refresh"
      label="Refresh"
      size="small"
      (onClick)="loadAssets()"
    />
  </header>

  @if (isLoading()) {
    <p-message severity="info">Loading assets...</p-message>
  } @else if (errorMessage()) {
    <div class="error-shell">
      <p-message severity="error">{{ errorMessage() ?? '' }}</p-message>
      <p-button
        label="Try again"
        severity="danger"
        variant="outlined"
        styleClass="retry-button"
        (onClick)="loadAssets()"
      />
    </div>
  } @else {
    <p-table #assetTable [value]="assets()" class="asset-table">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            Name
            <p-sortIcon field="name" />
          </th>
          <th pSortableColumn="type">
            Type
            <p-sortIcon field="type" />
          </th>
          <th pSortableColumn="location">
            Location
            <p-sortIcon field="location" />
          </th>
          <th pSortableColumn="status">
            Status
            <p-sortIcon field="status" />
          </th>
          <th class="configure-col">Configure</th>
        </tr>
        <tr class="asset-filter-row">
          <th>
            <input
              id="asset-name-filter"
              type="text"
              [value]="nameFilterValue()"
              placeholder="Filter name"
              (input)="onTextFilter($event, assetTable, 'name')"
            />
          </th>
          <th>
            <p-select
              inputId="asset-type-filter"
              [options]="typeFilterOptions()"
              optionLabel="label"
              optionValue="value"
              [ngModel]="typeFilterValue()"
              placeholder="All types"
              [showClear]="true"
              appendTo="body"
              (ngModelChange)="onSelectFilter(assetTable, 'type', $event)"
            />
          </th>
          <th>
            <input
              id="asset-location-filter"
              type="text"
              [value]="locationFilterValue()"
              placeholder="Filter location"
              (input)="onTextFilter($event, assetTable, 'location')"
            />
          </th>
          <th>
            <p-select
              inputId="asset-status-filter"
              [options]="statusFilterOptions()"
              optionLabel="label"
              optionValue="value"
              [ngModel]="statusFilterValue()"
              placeholder="All statuses"
              [showClear]="true"
              appendTo="body"
              (ngModelChange)="onSelectFilter(assetTable, 'status', $event)"
            />
          </th>
          <th></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-asset>
        <tr>
          <td>{{ asset.name }}</td>
          <td>{{ asset.type | titlecase }}</td>
          <td>{{ asset.location }}</td>
          <td>
            <p-tag [value]="asset.status | titlecase" [severity]="statusSeverity(asset.status)" />
          </td>
          <td class="configure-cell">
            <p-button
              icon="pi pi-cog"
              [rounded]="true"
              [text]="true"
              size="small"
              ariaLabel="Configure asset"
              styleClass="asset-config-button"
              (onClick)="openConfigurationDialog(asset)"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>
  }

  @defer (when isConfigurationDialogVisible()) {
    <app-asset-configuration-dialog
      [visible]="isConfigurationDialogVisible()"
      [asset]="selectedConfigurationAsset()"
      (visibleChange)="onConfigurationDialogVisibleChange($event)"
    />
  }
</section>
